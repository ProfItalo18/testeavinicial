<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S.G.R. - Escola Manain</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
</head>

<body>
  <!-- LOGIN GLOBAL (obrigatório) -->
  <div id="loginOverlay" class="modal-overlay" aria-hidden="false" style="display:flex;">
    <div class="modal-box modal-auth" role="dialog" aria-modal="true" aria-labelledby="loginTitulo">
      <div class="modal-header">
        <h3 id="loginTitulo"><i class="fas fa-right-to-bracket"></i> Acesso ao Sistema</h3>
      </div>
      <div class="modal-body">
        <p class="auth-sub">Entre com seu e-mail e senha. Apenas usuários cadastrados pelo administrador possuem acesso.</p>
        <div class="grid-auth">
          <div class="campo">
            <label for="loginEmail">E-mail</label>
            <input id="loginEmail" type="email" placeholder="seuemail@..." autocomplete="username" />
          </div>
          <div class="campo">
            <label for="loginSenha">Senha</label>
            <input id="loginSenha" type="password" placeholder="********" autocomplete="current-password" />
          </div>
        </div>
        <div class="auth-actions">
          <button type="button" class="btn-sistema btn-verde" id="btnLoginEntrar">
            <i class="fas fa-unlock"></i> ENTRAR
          </button>
          <button type="button" class="btn-sistema btn-cinza" id="btnLoginEsqueci">
            <i class="fas fa-circle-question"></i> ESQUECI A SENHA
          </button>
        </div>
        <div class="auth-msg" id="loginMsg" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- ================= SIDEBAR ================= -->
  
  <!-- Sidebar removida (substituída por modal) -->
<!-- ================= TOP CONTROLS ================= -->
  <div class="controles-topo no-print">
    <div class="grupo-botoes-esq">
      <button type="button" id="btnBuscar" class="btn-sistema btn-azul" onclick="abrirModalRelatorios()">
        <i class="fas fa-magnifying-glass"></i> BUSCAR
      </button>
      <button type="button" id="btnAdmin" class="btn-sistema btn-roxo" onclick="abrirAdmin()" style="display:none;">
        <i class="fas fa-user-shield"></i> ADMIN
      </button>
      <button type="button" id="btnLogout" class="btn-sistema btn-cinza" style="display:none;">
        <i class="fas fa-right-from-bracket"></i> SAIR
      </button>

    </div>
    <div class="grupo-botoes-dir">
      <button type="button" id="btnSalvar" class="btn-sistema btn-verde" onclick="salvarNoBanco()">
        <i class="fas fa-save"></i> SALVAR / ATUALIZAR
      </button>
      <button type="button" class="btn-sistema btn-imprimir" onclick="window.print()">
        <i class="fas fa-print"></i> IMPRIMIR
      </button>
    </div>
  </div>

  <!-- ================= A4 CONTAINER ================= -->
  <table class="tabela-impressao" role="presentation">
    <thead>
      <tr>
        <td>
          <header class="cabecalho-oficial">
            <div class="logo-container">
              <img src="col.png" alt="Logo" class="logo-img" />
            </div>
            <div class="texto-cabecalho">
              <h2 class="nome-mantenedora">CENTRO OCUPACIONAL DE LONDRINA</h2>
              <h3 class="nome-escola">
                Escola Manain - Educação Infantil e Ensino Fundamental,<br />
                na Modalidade Educação Especial
              </h3>
              <div class="dados-legais">
                <p>Fundado em 22/06/1985 - CNPJ 78.962.263/0001-79</p>
                <p>Utilidade Pública Municipal Lei Nº 3.956 de 24/04/1987</p>
              </div>
            </div>
          </header>
        </td>
      </tr>
    </thead>

    <tfoot>
      <tr>
        <td>
          <!-- Rodapé para IMPRESSÃO (repetido em todas as páginas) -->
          <footer class="rodape-print" aria-hidden="true">
            
            <div>Rua das Açucenas Nº 100 - Jd. Colina Verde - CEP: 86050-570 - Londrina/PR</div>
          </footer>
          <!-- Espaçador legado (tela). Em impressão é ocultado via CSS -->
          <div class="rodape-spacer" aria-hidden="true"></div>
        </td>
      </tr>
    </tfoot>

    <tbody>
      <tr>
        <td>
          <main class="conteudo-principal">
            <div class="titulo-documento">
              <h1>RELATÓRIO DE AVALIAÇÃO DE INGRESSO</h1>
              <input type="hidden" id="reportId" />
            </div>

            <!-- 1. IDENTIFICAÇÃO (TRAVADO PÓS-SALVAMENTO; EDITÁVEL NO NOVO) -->
            <section class="quadro-principal" aria-label="Dados de Identificação">
              <div class="titulo-sessao">1. DADOS DE IDENTIFICAÇÃO</div>
              <div class="corpo-sessao">
                <div class="grid-identificacao">
                  <div class="campo"><label>NRE:</label><input type="text" id="nre" value="LONDRINA" readonly /></div>
                  <div class="campo"><label>Município:</label><input type="text" id="municipio" value="LONDRINA" readonly /></div>
                  <div class="campo full-width"><label>Escola:</label><input type="text" id="escola" value="ESCOLA MANAIN" readonly /></div>

                  <div class="campo full-width">
                    <label>Estudante:</label>
                    <input type="text" id="nomeEstudante" placeholder="Nome completo do estudante" />
                  </div>

                  <div class="campo"><label>Data Nasc.:</label><input type="date" id="dataNascimento" /></div>
                  <div class="campo"><label>Idade:</label><input type="text" id="idade" readonly class="bg-gray" /></div>

                  <div class="campo full-width"><label>Filiação:</label><input type="text" id="filiacao" /></div>
                  <div class="campo"><label>Data Avaliação:</label><input type="date" id="dataAvaliacao" /></div>
                </div>

                <div class="box-destaque no-print">
                  <div class="controles-linha">
                    <span><strong>Obs:</strong> Para editar a Identificação de um relatório já salvo, use o botão abaixo.</span>
                    <button type="button" class="btn-mini" onclick="desbloquearIdentificacao()">
                      <i class="fas fa-unlock"></i> Editar Identificação
                    </button>
                  </div>
                </div>
              </div>
            </section>

            <div class="titulo-sessao">2. SÍNTESE DAS ÁREAS AVALIADAS</div>

            <section class="quadro-principal">
              <div class="cabecalho-interno">
                <h4>2.1 AVALIAÇÃO PEDAGÓGICA</h4>
                <p class="subtexto">Habilidades conceituais, cognitivas e acadêmicas.</p>
              </div>
              <div class="corpo-sessao">
                <div class="area-interativa no-print">
                  <button type="button" class="btn-sistema btn-checklist" onclick="abrirModal('pedagogica')">
                    <i class="fas fa-list-check"></i> Checklist Pedagógico
                  </button>
                  <span id="status-pedagogica" class="status pendente">Pendente</span>
                </div>
                <textarea id="texto-pedagogica" class="visually-hidden" aria-hidden="true"></textarea>
              </div>
            </section>

            <section class="quadro-principal">
              <div class="cabecalho-interno">
                <h4>2.2 AVALIAÇÃO CLÍNICA</h4>
                <p class="subtexto">Desempenho clínico, saúde e autonomia.</p>
              </div>
              <div class="corpo-sessao">
                <div class="area-interativa no-print">
                  <button type="button" class="btn-sistema btn-checklist" onclick="abrirModal('clinica')">
                    <i class="fas fa-user-md"></i> Checklist Clínico
                  </button>
                  <span id="status-clinica" class="status pendente">Pendente</span>
                </div>
                <textarea id="texto-clinica" class="visually-hidden" aria-hidden="true"></textarea>
              </div>
            </section>

            <section class="quadro-principal">
              <div class="cabecalho-interno">
                <h4>2.3 AVALIAÇÃO DO SERVIÇO SOCIAL</h4>
                <p class="subtexto">Entrevistas e observações.</p>
              </div>
              <div class="corpo-sessao">
                <div class="area-interativa no-print">
                  <button type="button" class="btn-sistema btn-checklist" onclick="abrirModal('social')">
                    <i class="fas fa-home"></i> Checklist Social
                  </button>
                  <span id="status-social" class="status pendente">Pendente</span>
                </div>
                <textarea id="texto-social" class="visually-hidden" aria-hidden="true"></textarea>
              </div>
            </section>

            <section class="quadro-principal">
              <div class="corpo-sessao">
                <div class="bloco-final">
                  <div class="controles-linha no-print">
                    <label>CONCLUSÃO DIAGNÓSTICA:</label>
                    <button type="button" class="btn-mini" onclick="gerarConclusaoAutomatica()">
                      <i class="fas fa-magic"></i> Gerar Texto Automático
                    </button>
                  </div>
                  <label class="print-only">3. CONCLUSÃO DIAGNÓSTICA:</label>
                  <textarea id="final-conclusao" rows="4"></textarea>
                </div>

                <div class="bloco-final"><label>4. INDICAÇÕES PEDAGÓGICAS:</label><textarea id="final-indicacoes" rows="3"></textarea></div>
                <div class="bloco-final"><label>5. ENCAMINHAMENTOS:</label><textarea id="final-encaminhamentos" rows="2"></textarea></div>
                <div class="bloco-final bloco-observacoes"><label>6. OBSERVAÇÕES COMPLEMENTARES:</label>
        <p class="hint-lock"><i class="fas fa-lock"></i> Observações fixas (geradas automaticamente conforme legislação).</p>
<textarea id="final-observacoes" rows="2" readonly></textarea></div>
              </div>
            </section>

            <section class="assinaturas-final" aria-label="Assinaturas">
              <p class="data-extenso">Londrina/PR, <span id="dataAtual"></span>.</p>

              <div class="assinaturas-grid">
                <div class="assinatura-box locked">
<div id="container_img_pedagoga" class="img-wrap"><img id="img_pedagoga" src="asspedagoda.png" alt="Assinatura" class="img-assinatura" /></div>
                  <p id="cargo_pedagoga" class="cargo">Pedagoga</p>
                </div>

                <div class="assinatura-box locked">
<div id="container_img_psicologa" class="img-wrap"><img id="img_psicologa" src="asspsicologa.png" alt="Assinatura" class="img-assinatura" /></div>
                  <p id="cargo_psicologa" class="cargo">Psicóloga</p>
                </div>

                <div class="assinatura-box locked">
<div id="container_img_social" class="img-wrap"><img id="img_social" src="asssocial.png" alt="Assinatura" class="img-assinatura" /></div>
                  <p id="cargo_social" class="cargo">Assistente Social</p>
                </div>
              </div>
            </section>
          </main>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ================= FOOTER ================= -->
  <footer id="rodape-fixo" class="rodape-fixo">
    <div class="endereco-oficial">
            <p>Rua das Açucenas Nº 100 - Jd. Colina Verde - CEP: 86050-570 - Londrina/PR</p>

    </div>
  </footer>

  <!-- ================= MODAL CHECKLIST ================= -->
  <div id="modalOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal-box grande" role="dialog" aria-modal="true" aria-labelledby="modalTitulo">
      <div class="modal-header">
        <h3 id="modalTitulo">Checklist</h3>
        <button type="button" class="btn-fechar" onclick="fecharModal()" aria-label="Fechar">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="coluna-checklist">
          <h4><i class="fas fa-check-double"></i> Selecione os itens:</h4>
          <div id="container-checklist"></div>
        </div>

        <div class="coluna-textos">
          <label class="label-azul">1. Texto do Relatório:</label>
          <textarea id="modalTexto" rows="8"></textarea>

          <label class="label-azul" id="labelExtra">2. Encaminhamentos/Indicações:</label>
          <textarea id="modalExtra" rows="8"></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-sistema btn-salvar" onclick="salvarModal()">
          <i class="fas fa-check"></i> CONFIRMAR E FECHAR
        </button>
      </div>
    </div>
  </div>
    <!-- Firebase (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>


  <script src="script.js"></script>

  <!-- ================= MODAL: MEUS RELATÓRIOS ================= -->
  <div id="relatoriosOverlay" class="modal-overlay no-print" style="display:none" aria-hidden="true">
    <div class="modal-box modal-relatorios" role="dialog" aria-modal="true" aria-label="Meus Relatórios">
      <div class="modal-header">
        <h3><i class="fas fa-folder-open"></i> MEUS RELATÓRIOS</h3>
        <button type="button" class="btn-fechar" onclick="fecharModalRelatorios()" aria-label="Fechar">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="rel-tools">
          <div class="check-search" style="flex:1; min-width: 240px;">
            <i class="fas fa-search"></i>
            <input id="buscaRelatorioModal" type="text" placeholder="Buscar relatório (nome ou ID)..." autocomplete="off" />
          </div>
        </div>

        <div id="listaRelatoriosModal" class="lista-relatorios" role="list"></div>
</div>
    </div>
  </div>


  <!-- ================= AUTH MODAL (por área) ================= -->
  <div id="authOverlay" class="modal-overlay no-print" aria-hidden="true" style="display:none;">
    <div class="modal-box modal-auth" role="dialog" aria-modal="true" aria-labelledby="authTitulo">
      <div class="modal-header">
        <h3 id="authTitulo"><i class="fas fa-lock"></i> Acesso da Área</h3>
        <button type="button" class="btn-fechar" onclick="fecharAuth()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p class="auth-sub" id="authSub">Informe e-mail e senha para acessar esta avaliação.</p>

        <div class="grid-auth">
          <div class="campo">
            <label for="authEmail">E-mail</label>
            <input id="authEmail" type="email" placeholder="ex.: nome@dominio.com" autocomplete="username" />
          </div>
          <div class="campo">
            <label for="authSenha">Senha</label>
            <input id="authSenha" type="password" placeholder="••••••••" autocomplete="current-password" />
          </div>
        </div>

        <div class="auth-actions">
          <button type="button" class="btn-sistema btn-primario" onclick="confirmarAuth()">
            <i class="fas fa-right-to-bracket"></i> Entrar
          </button>
          <button type="button" class="btn-sistema btn-neutro" onclick="fecharAuth()">Cancelar</button>
        </div>

        <div class="auth-msg" id="authMsg" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- ================= ADMIN MODAL (cadastro de usuários) ================= -->
  <div id="adminOverlay" class="modal-overlay no-print" aria-hidden="true" style="display:none;">
    <div class="modal-box modal-admin" role="dialog" aria-modal="true" aria-labelledby="adminTitulo">
      <div class="modal-header">
        <h3 id="adminTitulo"><i class="fas fa-user-shield"></i> Painel do Administrador</h3>
        <button type="button" class="btn-fechar" onclick="fecharAdmin()"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-body">
        <div id="adminLoginBox">
          <p class="auth-sub">Apenas o administrador pode cadastrar os responsáveis de cada área.</p>
          <div class="grid-auth">
            <div class="campo">
              <label for="adminEmail">E-mail do Admin</label>
              <input id="adminEmail" type="email" placeholder="admin@..." autocomplete="username" />
            </div>
            <div class="campo">
              <label for="adminSenha">Senha do Admin</label>
              <input id="adminSenha" type="password" placeholder="••••••••" autocomplete="current-password" />
            </div>
          </div>
          <div class="auth-actions">
            <button type="button" class="btn-sistema btn-primario" onclick="entrarAdmin()">
              <i class="fas fa-key"></i> Entrar
            </button>
            <button type="button" class="btn-sistema btn-neutro" onclick="fecharAdmin()">Cancelar</button>
          </div>
          <div class="auth-msg" id="adminMsg" aria-live="polite"></div>
        </div>

        <div id="adminPainel" style="display:none;">
          <div class="admin-grid">
            <div class="admin-card">
              <h4><i class="fas fa-user-graduate"></i> Pedagógica (Assinatura Pedagoga)</h4>
              <div class="campo">
                <label>E-mail</label>
                <input id="userPedEmail" type="email" placeholder="pedagoga@..." />
              </div>
              <div class="campo">
                <label>Senha</label>
                <input id="userPedSenha" type="password" placeholder="Defina uma senha" />
              </div>
              <div class="campo">
                <label>Assinatura da Pedagoga (imagem)</label>
                <input id="userPedAss" type="file" accept="image/*" />
                <small class="hint">Envie a assinatura em PNG/JPG (fundo transparente se possível).</small>
                <div class="preview-ass">
                  <img id="previewPedAss" alt="Prévia da assinatura" />
                </div>
              </div>
              <button type="button" class="btn-sistema btn-sucesso" onclick="salvarUsuarioArea('pedagogica')">
                <i class="fas fa-floppy-disk"></i> Salvar credenciais
              </button>
              <div class="cred-header"><i class="fas fa-users"></i> Credenciais cadastradas</div>
              <div class="cred-list" id="credList_pedagogica"></div>

            </div>

            <div class="admin-card">
              <h4><i class="fas fa-user-doctor"></i> Clínica (Assinatura Psicóloga)</h4>
              <div class="campo">
                <label>E-mail</label>
                <input id="userCliEmail" type="email" placeholder="psicologa@..." />
              </div>
              <div class="campo">
                <label>Senha</label>
                <input id="userCliSenha" type="password" placeholder="Defina uma senha" />
              </div>
              <div class="campo">
                <label>Assinatura da Psicóloga (imagem)</label>
                <input id="userCliAss" type="file" accept="image/*" />
                <small class="hint">Envie a assinatura em PNG/JPG (fundo transparente se possível).</small>
                <div class="preview-ass">
                  <img id="previewCliAss" alt="Prévia da assinatura" />
                </div>
              </div>
              <button type="button" class="btn-sistema btn-sucesso" onclick="salvarUsuarioArea('clinica')">
                <i class="fas fa-floppy-disk"></i> Salvar credenciais
              </button>
              <div class="cred-header"><i class="fas fa-users"></i> Credenciais cadastradas</div>
              <div class="cred-list" id="credList_clinica"></div>

            </div>

            <div class="admin-card">
              <h4><i class="fas fa-hands-helping"></i> Serviço Social (Assinatura Assistente Social)</h4>
              <div class="campo">
                <label>E-mail</label>
                <input id="userSocEmail" type="email" placeholder="social@..." />
              </div>
              <div class="campo">
                <label>Senha</label>
                <input id="userSocSenha" type="password" placeholder="Defina uma senha" />
              </div>
              <div class="campo">
                <label>Assinatura da Assistente Social (imagem)</label>
                <input id="userSocAss" type="file" accept="image/*" />
                <small class="hint">Envie a assinatura em PNG/JPG (fundo transparente se possível).</small>
                <div class="preview-ass">
                  <img id="previewSocAss" alt="Prévia da assinatura" />
                </div>
              </div>
              <button type="button" class="btn-sistema btn-sucesso" onclick="salvarUsuarioArea('social')">
                <i class="fas fa-floppy-disk"></i> Salvar credenciais
              </button>
              <div class="cred-header"><i class="fas fa-users"></i> Credenciais cadastradas</div>
              <div class="cred-list" id="credList_social"></div>

            </div>
          </div>

          <div class="admin-footer">
            <button type="button" class="btn-sistema btn-perigo" onclick="sairAdmin()">
              <i class="fas fa-right-from-bracket"></i> Sair do Admin
            </button>
          </div>
          <div class="auth-msg" id="adminMsg2" aria-live="polite"></div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
